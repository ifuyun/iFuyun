<? include ../common/header.html ?>
<div id="body-wrapper">
    <? include ../elements/leftNav.html ?>
    <div id="content">
        <? include ../elements/topBar.html ?>
        <div id="control-panel">
            <h2>链接</h2>
            <div class="split-line"><div class="split-corner">&nbsp;</div></div>
            <!-- <div id="search-bar"> -->
                <form method="get" action="#">
                    <!-- <input type="text" class="input keyword" id="keyword" name="keyword" placeholder="搜索..." />
                    <input type="submit" class="button" value="搜索链接" /> -->
                    <input type="hidden" name="_csrf" id="csrfToken" value="<?- token ?>" />
                </form>
            <!-- </div> -->
            <div class="clear-right">
                <div class="table-nav">
                    <span><a class="button button-spacing" href="javascript:;">删除</a></span>
                    <span><a class="button button-spacing" href="/admin/link/new">新增链接</a></span>
                    <span><a class="button" href="/admin/category?type=link">链接分类</a></span>
                </div>
                <div>
                    <table class="list-table">
                        <thead>
                            <tr>
                                <th width="2%" class="column-check"><input type="checkbox" class="checkAll" /></th>
                                <th width="10%">名称</th>
                                <th width="20%">URL</th>
                                <th width="15%">描述</th>
                                <th width="8%">可见性</th>
                                <th width="10%">打开方式</th>
                                <th width="8%">排序</th>
                                <th width="10%">添加时间</th>
                                <th width="17%">操作</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th class="column-check"><input type="checkbox" class="checkAll" /></th>
                                <th>名称</th>
                                <th>URL</th>
                                <th>描述</th>
                                <th>可见性</th>
                                <th>打开方式</th>
                                <th>排序</th>
                                <th>添加时间</th>
                                <th>操作</th>
                            </tr>
                        </tfoot>
                        <tbody>
                            <? if(linkData && linkData.links.length > 0) { ?>
                            <? var rowIdx = 0; ?>
                            <? linkData.links.forEach(function(link){ ?>
                            <tr<? if(rowIdx % 2 === 0) { ?> class="alternate"<? } ?>>
                                <td class="column-check"><input type="checkbox" class="checkRow" /></td>
                                <td title="<?- link.link_name ?>"><?= util.cutStr(link.link_name, 20) ?></td>
                                <td title="<?- link.link_url ?>"><?= util.cutStr(link.link_url, 20) ?></td>
                                <td title="<?- link.link_description ?>"><?= util.cutStr(link.link_description, 20) ?></td>
                                <td><?= link.link_visible ?></td>
                                <td><?= link.link_target ?></td>
                                <td><?= link.link_rating ?></td>
                                <td><?= moment(link.link_created).format('YYYY-MM-DD') ?></td>
                                <td>
                                    <a class="button button-not-last btn-edit" href="/admin/link/<?= link.link_id ?>">编辑</a><a class="button button-not-last btn-delete" href="javascript:;" data-id="<?= link.link_id ?>">删除</a>
                                </td>
                            </tr>
                            <? rowIdx += 1; ?>
                            <? }) ?>
                            <? } else { ?>
                                <tr class="alternate">
                                    <td colspan="6">无记录</td>
                                </tr>
                            <? } ?>
                        </tbody>
                    </table>
                </div>
                <div class="table-nav">
                    <span><a class="button" href="javascript:;">删除</a></span>
                </div>
                <? include ../elements/pageBar.html ?>
            </div>
        </div>
    </div>
    <? include ../elements/pageFooter.html ?>
</div>
<script type="text/javascript" src="/js/vendor/jquery-1.11.0.min.js"></script>
<script type="text/javascript">
    $(function(){
        $('.btn-delete').on('click', function(e){
            var $that = $(this);
            $.ajax({
                type: 'post',
                url: '/admin/link/remove',
                data: {
                    linkId: $that.attr('data-id')
                },
                headers: {
                    'X-CSRF-Token': $('#csrfToken').val()
                },
                dataType: 'json',
                success: function (d, s, xhr) {
                    if(d.code === 0){
                        // location.href = d.data.url;
                        window.location.reload();
                    } else {
                        alert(d.message);
                    }
                },
                error: function (xhr, s, err) {
                    return false;
                }
            });
            return false;
        });
    });
</script>
<? include ../common/footer.html ?>